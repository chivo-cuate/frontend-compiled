(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fd5a0e6"],{"1aae":function(e,t,s){e.exports=s.p+"img/table2.cb361b8d.png"},"1fb1":function(e,t,s){var r={"./table-1.png":"ed14","./table0.png":"e481","./table1.png":"61ad","./table2.png":"1aae"};function a(e){var t=i(e);return s(t)}function i(e){var t=r[e];if(!(t+1)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return t}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id="1fb1"},"5c6c":function(e,t,s){},"5fc5":function(e,t,s){"use strict";var r=s("5c6c"),a=s.n(r);a.a},"61ad":function(e,t,s){e.exports=s.p+"img/table1.cb361b8d.png"},ba26:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-flex",{attrs:{xs12:""}},[e.loadingInitialData?s("VProgress",{staticClass:"text-center",attrs:{message:"Cargando"}}):s("v-flex",{staticClass:"animated fadeIn"},[s("Tables",{attrs:{tables:e.tables,assets:e.assets},on:{playSound:function(t){return e.playNotifSound()},setResponse:function(t){return e.setResponse(t)}}})],1),s("AxiosComponent",{ref:"axios",on:{finish:function(t){return e.handleHttpResponse(t)}}})],1)},a=[],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-card",{staticClass:"pb-7"},[r("v-card-title",{class:"title "+e.$store.getters.getThemeColor+" white--text",attrs:{"primary-title":""}},[e._v("Mesas disponibles")]),r("v-layout",{attrs:{wrap:"","text-center":"","mt-2":""}},e._l(e.tables,function(t,a){return r("v-flex",{key:"table-"+a,staticClass:"animated fadeIn mt-5 mr-2 text-center"},[r("v-menu",{attrs:{dark:"","offset-y":"",transition:"fade-transition",bottom:"","open-on-hover":""},scopedSlots:e._u([{key:"activator",fn:function(a){var i=a.on;return[r("v-flex",{staticClass:"text-center align-center"},[r("v-btn",{attrs:{text:"",disabled:""}},[t.ordersByCategory?e._l(t.ordersByCategory,function(t,s){return r("v-badge",{key:"badge-"+s,staticClass:"animated slideInDown",style:"bottom: 32px; left: "+(59-20*s)+"px;",attrs:{color:t.badge_color,overlap:""},scopedSlots:e._u([{key:"badge",fn:function(){return[r("span",[e._v(e._s(t.badge_icon))])]},proxy:!0}],null,!0)})}):e._e(),r("v-img",{attrs:{src:s("1fb1")("./table"+t.status_id+".png"),width:"70px"}})],2)],1),r("v-flex",{attrs:{"mb-3":""}},[r("v-chip",e._g({staticClass:"table-number-menu"},i),[e._v("Mesa "+e._s(t.table_number))])],1)]}}],null,!0)},[r("v-list",[r("v-list-item",{staticClass:"dropdown-menu-item",on:{click:function(s){return e.setEditedTable(t,a,"add")}}},[r("v-icon",[e._v("local_dining")]),r("span",[e._v("Agregar orden")])],1),-1!==t.status_id?r("v-list-item",{staticClass:"dropdown-menu-item",on:{click:function(s){return e.setEditedTable(t,a,"edit")}}},[r("v-icon",[e._v("local_dining")]),r("span",[e._v("Ver órdenes")])],1):e._e()],1)],1)],1)}),1),r("v-navigation-drawer",{attrs:{absolute:"",temporary:"",permanent:e.drwOrders,right:"",bottom:""},model:{value:e.drwOrders,callback:function(t){e.drwOrders=t},expression:"drwOrders"}},[e.drwOrders?[r("v-list-item",{staticClass:"grey"},[r("v-list-item-content",[r("v-list-item-title",{staticClass:"uppercase"},[e._v("Órdenes - Mesa "+e._s(e.editedTable.table_number))])],1),r("v-list-item-icon",[r("v-icon",{on:{click:function(t){e.drwOrders=!1}}},[e._v("close")])],1)],1),r("v-divider"),e._l(e.editedOrdersByCategory,function(t,s){return r("v-list",{key:"order-"+s,attrs:{dense:""}},[r("v-list-item",[r("v-list-item-content",[r("v-list-item-title",{class:"uppercase "+t.badge_color+"--text"},[r("v-icon",{class:t.badge_color+"--text",attrs:{small:""}},[e._v(e._s(t.list_icon))]),e._v("\n                "+e._s(t.list_name)+"\n              ")],1)],1)],1),e._l(t.orders,function(t,a){return r("v-list-item",{key:"order-"+a},[r("v-list-item-content",[r("v-layout",{attrs:{wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-chip",{attrs:{small:""}},[e._v("Orden #"+e._s(a+1))])],1),t.attribs.edit?r("v-flex",{attrs:{xs2:""}},[r("v-btn",{attrs:{text:"","x-small":""},on:{click:function(t){return e.showDlgEditOrder(s,a)}}},[r("v-icon",{staticClass:"warning--text"},[e._v("edit")])],1)],1):e._e(),t.attribs.delete?r("v-flex",{attrs:{xs2:""}},[r("v-btn",{attrs:{text:"","x-small":""},on:{click:function(t){return e.showDlgCancelOrder(s,a)}}},[r("v-icon",{staticClass:"error--text"},[e._v("delete")])],1)],1):e._e(),t.attribs.close?r("v-flex",{attrs:{xs2:""}},[r("v-btn",{attrs:{text:"","x-small":""}},[r("v-icon",{staticClass:"success--text"},[e._v("attach_money")])],1)],1):e._e()],1)],1)],1)}),r("v-divider")],2)})]:e._e()],2),r("v-dialog",{attrs:{width:"700",persistent:""},model:{value:e.dlgTableOrder,callback:function(t){e.dlgTableOrder=t},expression:"dlgTableOrder"}},[r("v-card",[r("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[e._v("Mesa "+e._s(e.editedTable.table_number))]),r("v-card-text",[r("v-container",{attrs:{"grid-list-md":""}},[r("v-layout",{attrs:{wrap:"","mb-3":""}},[r("v-flex",{attrs:{xs12:""}},[r("v-btn",{class:e.$store.getters.getThemeColor+" white--text",attrs:{disabled:e.editedAssetsLength>0&&!e.validAssetForm},on:{click:function(t){return e.addAsset()}}},[r("v-icon",[e._v("mdi-food")]),e._v("Nuevo producto\n                ")],1)],1)],1),r("v-form",{ref:"form",on:{submit:function(e){e.preventDefault()}},model:{value:e.validAssetForm,callback:function(t){e.validAssetForm=t},expression:"validAssetForm"}},[e._l(e.editedAssets,function(t,s){return r("v-layout",{key:"prod-"+s,attrs:{wrap:""}},[r("v-flex",{attrs:{xs8:"",sm6:""}},[r("v-autocomplete",{staticStyle:{"max-height":"20px!important"},attrs:{"small-chips":"",clearable:"",rules:e.requiredRules,readonly:"1"===t.finished,items:e.assets,"item-color":e.$store.getters.getThemeColor,"item-text":"name","item-value":"id",label:"Producto","no-data-text":"No hay resultados"},on:{change:function(t){return e.removeDuplicateAssets()}},scopedSlots:e._u([{key:"item",fn:function(t){return[r("v-list-item-content",[r("v-list-item-title",{domProps:{innerHTML:e._s(t.item.name)}}),r("v-list-item-subtitle",{domProps:{innerHTML:e._s("Precio: $"+t.item.price+(t.item.grams?" ("+t.item.grams+" gramos)":""))}})],1)]}}],null,!0),model:{value:t.asset_id,callback:function(s){e.$set(t,"asset_id",s)},expression:"editedAssetAux.asset_id"}})],1),r("v-flex",{attrs:{xs4:"",sm2:""}},[r("v-text-field",{attrs:{rules:e.numberRules,readonly:"1"===t.finished,label:"Unidades",type:"number"},model:{value:t.quantity,callback:function(s){e.$set(t,"quantity",s)},expression:"editedAssetAux.quantity"}})],1),r("v-flex",{attrs:{xs4:"",sm2:""}},[r("v-text-field",{attrs:{readonly:"",value:e.getAssetPriceById(t.asset_id,t.quantity),label:"Precio"}})],1),r("v-flex",{attrs:{xs12:"",sm2:""}},[r("v-btn",{staticClass:"error",attrs:{width:"100%"},on:{click:function(t){return e.removeAsset(s)}}},[e._v("Eliminar")])],1)],1)}),r("v-layout",{attrs:{wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("span",[e._v("Total:")]),r("v-chip",[r("v-icon",{attrs:{left:""}},[e._v("attach_money")]),e._v("\n                    "+e._s(e.calculateTotalPrice)+"\n                  ")],1)],1)],1)],2)],1)],1),r("v-divider"),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{disabled:e.editedAssetsLength<1||!e.validAssetForm||e.handlingOrder,color:e.$store.getters.getThemeColor,text:""},on:{click:function(t){return e.sendOrder()}}},[e.handlingOrder?r("v-progress-circular",{staticClass:"v-icon",attrs:{size:15,width:1,indeterminate:""}}):e._e(),r("span",{domProps:{innerHTML:e._s(e.editedOrder.id?"Editar":"Agregar")}})],1),r("v-btn",{attrs:{color:"error",text:""},on:{click:function(t){e.dlgTableOrder=!1}}},[e._v("Cancelar")])],1)],1)],1),r("v-dialog",{attrs:{width:"500",persistent:""},model:{value:e.dlgCheckout,callback:function(t){e.dlgCheckout=t},expression:"dlgCheckout"}},[r("v-card",[r("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[e._v("Mesa "+e._s(e.editedTable.table_number))]),r("v-card-text",[r("v-container",{attrs:{"grid-list-md":""}},[r("v-layout",{attrs:{wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-card-text",[e._v("Se dispone a cerrar la cuenta de la mesa # "+e._s(e.editedTable.table_number)+" con un monto de:")]),r("p",{staticClass:"text-center"},[r("v-chip",{staticClass:"error"},[r("v-icon",{attrs:{color:"white",medium:"",left:""}},[e._v("attach_money")]),e._v("\n                    "+e._s(e.calculateTotalPrice)+"\n                  ")],1)],1),r("p",{staticClass:"text-center"},[e._v("¿Confirma que desea continuar?")])],1)],1)],1)],1),r("v-divider"),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{disabled:e.handlingOrder,color:e.$store.getters.getThemeColor,text:""},on:{click:function(t){return e.checkout()}}},[e.handlingOrder?r("v-progress-circular",{staticClass:"v-icon",attrs:{size:15,width:1,indeterminate:""}}):e._e(),r("span",[e._v("Continuar")])],1),r("v-btn",{attrs:{color:"error",text:""},on:{click:function(t){e.dlgCheckout=!1}}},[e._v("Cancelar")])],1)],1)],1),r("v-dialog",{attrs:{width:"500",persistent:""},model:{value:e.dlgCancelOrder,callback:function(t){e.dlgCancelOrder=t},expression:"dlgCancelOrder"}},[r("v-card",[r("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[e._v("Mesa "+e._s(e.editedTable.table_number))]),r("v-card-text",[r("v-container",{attrs:{"grid-list-md":""}},[r("v-layout",{attrs:{wrap:""}},[r("v-flex",{attrs:{xs12:""}},[r("v-card-text",{staticClass:"text-center"},[e._v("\n                  Se dispone a cancelar la orden # "+e._s(this.editedOrderIndex+1)+" de la mesa # "+e._s(e.editedTable.table_number)+".\n                  "),r("br"),e._v("¿Confirma que desea continuar?\n                ")])],1)],1)],1)],1),r("v-divider"),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{disabled:e.handlingOrder,color:e.$store.getters.getThemeColor,text:""},on:{click:function(t){return e.cancelOrder()}}},[e.handlingOrder?r("v-progress-circular",{staticClass:"v-icon",attrs:{size:15,width:1,indeterminate:""}}):e._e(),r("span",[e._v("Continuar")])],1),r("v-btn",{attrs:{color:"error",text:""},on:{click:function(t){e.dlgCancelOrder=!1}}},[e._v("Cancelar")])],1)],1)],1),r("AxiosComponent",{ref:"axios",on:{finish:function(t){return e.handleHttpResponse(t)}}})],1)],1)},d=[],n={data(){return{handlingOrder:!1,editedTable:{},editedTableIndex:-1,editedOrdersByCategory:[],editedOrdersListIndex:-1,editedOrder:{},editedOrderIndex:{},editedAssets:[],editedAsset:{},drwOrders:!1,dlgTableOrder:!1,dlgCheckout:!1,dlgCancelOrder:!1,validAssetForm:!1,requiredRules:[e=>!!e||"Dato obligatorio"],numberRules:[e=>!!e||"Dato obligatorio",e=>e>0||"Dato incorrecto"],timer:null}},components:{},props:["tables","assets"],computed:{calculateTotalPrice(){let e=0;return this.editedAssets.forEach(t=>{e+=this.getAssetPriceById(t.asset_id,parseInt(t.quantity))}),e},editedAssetsLength(){return this.editedAssets.length}},methods:{setEditedAssets(){this.editedAssets=[],this.editedOrder.assets.forEach(e=>{e.price=this.getAssetById(e.asset_id).price,this.editedAssets.push(e)})},setEditedOrder(e,t){this.editedOrdersListIndex=e,this.editedOrderIndex=t;let s=this.editedOrdersByCategory[e].orders[t];this.editedOrder=Object.assign({},s)},showDlgEditOrder(e,t){this.setEditedOrder(e,t),this.setEditedAssets(),this.dlgTableOrder=!0},showDlgCancelOrder(e,t){this.setEditedOrder(e,t),this.dlgCancelOrder=!0},setEditedTable(e,t,s,r=null){switch(this.editedTable=e,this.editedTableIndex=t,s){case"add":this.editedOrder={},this.editedAssets=[],this.dlgTableOrder=!0;break;case"edit":this.editedOrdersByCategory=this.editedTable.ordersByCategory,this.drwOrders=!0;break;case"checkout":this.dlgCheckout=!0;break;case"cancel":this.dlgCancelOrder=!0;break}},getTableColor(e){switch(e){case 0:return`${this.$store.getters.getThemeColor} fa`;case 1:return"warning fa";case-1:return"error fa";default:return"grey fa"}},getAssetById(e){let t=this.assets.find(t=>{return t.id===e});return t},getAssetPriceById(e,t){let s=this.getAssetById(e);return s?parseInt(s.price)*(t?parseInt(t):1):0},removeAsset(e){this.editedAssets.splice(e,1),this.removeDuplicateAssets()},getEditedAssetIndexById(e){return this.editedAssets.findIndex(t=>t.asset_id===e)},removeDuplicateAssets(){let e=[];for(let t=0;t<this.editedAssetsLength;t++){this.editedAssets[t].price=this.getAssetById(this.editedAssets[t].asset_id).price;let s=e.findIndex(e=>e.asset_id===this.editedAssets[t].asset_id&&"0"===e.finished);s>=0?e[s].quantity=parseInt(e[s].quantity)+parseInt(this.editedAssets[t].quantity):e.push(this.editedAssets[t])}this.editedAssets=e},addAsset(){this.removeDuplicateAssets(),this.editedAsset={quantity:1,finished:"0"},this.editedAssets.push(this.editedAsset)},sendOrder(){if(this.removeDuplicateAssets(),!this.handlingOrder){this.handlingOrder=!0;var e={url:this.editedOrder.id?"ordenes/editar":"ordenes/crear",snackbar:!0,method:"post",params:{item:{table_number:this.editedTable.table_number,id:this.editedOrder.id},assets:this.editedAssets,branch_id:this.$store.getters.getCurrBranch.id}};this.$refs.axios.submit(e)}},cancelOrder(){if(!this.handlingOrder){this.handlingOrder=!0;var e={url:"ordenes/eliminar",snackbar:!0,method:"post",params:{id:this.editedOrder.id,table_number:this.editedTable.table_number,branch_id:this.$store.getters.getCurrBranch.id}};this.$refs.axios.submit(e)}},checkout(){if(!this.handlingOrder){this.handlingOrder=!0;var e={url:"ordenes/cerrar",snackbar:!0,method:"post",params:{id:this.editedTable.order,table_number:this.editedTable.table_number,branch_id:this.$store.getters.getCurrBranch.id}};this.$refs.axios.submit(e)}},handleHttpResponse(e){if(200===e.data.result.code){var t=e.data.result.response;this.handlingOrder=!1,this.dlgTableOrder=!1,this.dlgCheckout=!1,this.dlgCancelOrder=!1,"success"===t.code&&(this.$emit("setResponse",t),this.$emit("playSound"));let s=e.url.substring(e.url.lastIndexOf("/")+1);switch(s){case"eliminar":this.editedOrdersByCategory[this.editedOrdersListIndex].orders.splice(this.editedOrderIndex,1);break;case"editar":this.editedOrdersByCategory[this.editedOrdersListIndex].orders[this.editedOrderIndex].assets=this.editedAssets;break;default:break}}}}},l=n,o=(s("5fc5"),s("2877")),c=s("6544"),u=s.n(c),h=s("c6a6"),v=s("4ca6"),m=s("8336"),b=s("b0af"),g=s("99d9"),p=s("cc20"),f=s("a523"),x=s("169a"),_=s("ce7e"),y=s("0e8f"),C=s("4bd4"),O=s("132d"),A=s("adda"),k=s("a722"),w=s("8860"),T=s("da13"),I=s("5d23"),V=s("34c3"),D=s("e449"),B=s("f774"),$=s("490a"),P=s("2fa4"),E=s("8654"),L=Object(o["a"])(l,i,d,!1,null,"21ad5ccd",null),F=L.exports;u()(L,{VAutocomplete:h["a"],VBadge:v["a"],VBtn:m["a"],VCard:b["a"],VCardActions:g["a"],VCardText:g["b"],VCardTitle:g["c"],VChip:p["a"],VContainer:f["a"],VDialog:x["a"],VDivider:_["a"],VFlex:y["a"],VForm:C["a"],VIcon:O["a"],VImg:A["a"],VLayout:k["a"],VList:w["a"],VListItem:T["a"],VListItemContent:I["a"],VListItemIcon:V["a"],VListItemSubtitle:I["b"],VListItemTitle:I["c"],VMenu:D["a"],VNavigationDrawer:B["a"],VProgressCircular:$["a"],VSpacer:P["a"],VTextField:E["a"]});var M={data(){return{loadingInitialData:!0,loadingData:!1,tables:[],assets:[],audioPlayer:null}},components:{Tables:F},mounted(){this.timer=setInterval(this.getDataFromApi,5e3),this.getDataFromApi(),this.initAudioPlayer()},methods:{initAudioPlayer(){this.audioPlayer||(this.audioPlayer=new Audio(this.$store.getters.getBeepFile))},playNotifSound(){this.initAudioPlayer(),this.audioPlayer.play()},setResponse(e){this.tables=e.data.tables,this.assets=e.data.assets},handleHttpResponse(e){if(this.loadingData=!1,this.loadingInitialData=!1,200===e.data.result.code){var t=e.data.result.response;switch(this.operationMessage=t.msg,this.operationMessageType=t.code,e.url.substring(e.url.lastIndexOf("/")+1)){case"listar":"success"===t.code&&this.setResponse(t);break;default:this.snackbar=!0;break}}else this.operationMessage="Your request could not be executed.",this.operationMessageType="error",this.snackbar=!0},getDataFromApi(){if(!this.loadingData){this.loadingData=!0;var e={url:"ordenes/listar",params:{branch_id:this.$store.getters.getCurrBranch.id}};this.$refs.axios.submit(e)}}}},q=M,R=Object(o["a"])(q,r,a,!1,null,null,null);t["default"]=R.exports;u()(R,{VFlex:y["a"]})},e481:function(e,t,s){e.exports=s.p+"img/table0.cb361b8d.png"},ed14:function(e,t,s){e.exports=s.p+"img/table-1.2597e2c9.png"}}]);
//# sourceMappingURL=chunk-2fd5a0e6.e1d20692.js.map